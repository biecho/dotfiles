# ============================================================================
# Kitty Terminal Configuration
# ============================================================================

# Theme
include themes/catppuccin-mocha.conf

# ----------------------------------------------------------------------------
# Font
# ----------------------------------------------------------------------------
font_family JetBrainsMono Nerd Font
font_size 14

# ----------------------------------------------------------------------------
# Cursor
# ----------------------------------------------------------------------------
cursor_shape beam
cursor_blink_interval 0

# ----------------------------------------------------------------------------
# Window & Layout
# ----------------------------------------------------------------------------
window_padding_width 8
# Dim inactive windows (0.0-1.0, lower = more dim)
inactive_text_alpha 0.8

# Layouts: splits for panes, stack for "zoom" current pane fullscreen
enabled_layouts splits,stack

# ----------------------------------------------------------------------------
# Scrollback
# ----------------------------------------------------------------------------
scrollback_lines 50000

# Scrollback pager - view/search with nvim (cmd+shift+h)
scrollback_pager nvim -u NONE -c "set number signcolumn=no showtabline=0 foldcolumn=0 laststatus=0" -c "autocmd TermOpen * normal G" -c "silent write! /tmp/kitty_scrollback_buffer | te cat /tmp/kitty_scrollback_buffer - "
map cmd+shift+h show_scrollback

# Jump between shell prompts in scrollback (requires shell integration)
map cmd+shift+p scroll_to_prompt -1
map cmd+shift+n scroll_to_prompt 1

# ----------------------------------------------------------------------------
# Shell Integration & Clipboard
# ----------------------------------------------------------------------------
shell_integration enabled
copy_on_select clipboard

# Allow OSC 52 clipboard reads without confirmation (for nvim paste over SSH)
clipboard_control write-clipboard write-primary read-clipboard read-primary

# ----------------------------------------------------------------------------
# Remote Control (enables smart-splits.nvim integration)
# ----------------------------------------------------------------------------
# Required for seamless nvim/kitty navigation with smart-splits.nvim
# Kittens installed by: ./kitty/install-kittens.bash (run by lazy.nvim build)
allow_remote_control socket-only
listen_on unix:/tmp/kitty

# ----------------------------------------------------------------------------
# macOS Specific
# ----------------------------------------------------------------------------
macos_option_as_alt yes
macos_quit_when_last_window_closed yes

# ----------------------------------------------------------------------------
# Tab Bar
# ----------------------------------------------------------------------------
tab_bar_edge top
tab_bar_style powerline
tab_powerline_style slanted
# Show tab index and title
tab_title_template "{index}: {bell_symbol}{activity_symbol}{title}"

# ----------------------------------------------------------------------------
# Keybindings: Splits
# ----------------------------------------------------------------------------
# Create splits (follows current dir/server with SSH)
map cmd+\ launch --location=vsplit --cwd=current
map cmd+- launch --location=hsplit --cwd=current

# Local splits (always on local machine, useful when SSH'd)
map cmd+shift+\ launch --location=vsplit
map cmd+shift+- launch --location=hsplit

# Close window
map cmd+w close_window

# ----------------------------------------------------------------------------
# Keybindings: Window Navigation (smart-splits.nvim integration)
# ----------------------------------------------------------------------------
# ctrl+hjkl: seamless navigation between nvim and kitty splits
# When nvim is focused, keys pass through to nvim; otherwise kitty handles them
map ctrl+h neighboring_window left
map ctrl+j neighboring_window down
map ctrl+k neighboring_window up
map ctrl+l neighboring_window right

# Pass keys to nvim when it's focused (smart-splits handles navigation)
map --when-focus-on var:IS_NVIM ctrl+h
map --when-focus-on var:IS_NVIM ctrl+j
map --when-focus-on var:IS_NVIM ctrl+k
map --when-focus-on var:IS_NVIM ctrl+l

# alt+hjkl: resize splits (works in both nvim and kitty)
map alt+h kitten relative_resize.py left 3
map alt+j kitten relative_resize.py down 3
map alt+k kitten relative_resize.py up 3
map alt+l kitten relative_resize.py right 3

map --when-focus-on var:IS_NVIM alt+h
map --when-focus-on var:IS_NVIM alt+j
map --when-focus-on var:IS_NVIM alt+k
map --when-focus-on var:IS_NVIM alt+l

# ----------------------------------------------------------------------------
# Keybindings: Window Management
# ----------------------------------------------------------------------------
# Zoom current window (toggle between splits and stack layout)
map cmd+z toggle_layout stack

# Swap window position with another (visual selection)
map cmd+shift+s swap_with_window

# Resize window (enter resize mode, use hjkl to resize)
map cmd+r start_resizing_window

# Detach window: move current pane to new tab or OS window
map cmd+d detach_window new-tab
map cmd+shift+d detach_window

# ----------------------------------------------------------------------------
# Keybindings: Tabs
# ----------------------------------------------------------------------------
# New tab (follows current dir/server)
map cmd+t new_tab_with_cwd

# New local tab (always on local machine)
map cmd+shift+t new_tab

# Tab navigation
map cmd+shift+] next_tab
map cmd+shift+[ previous_tab

# Fuzzy tab picker (fzf)
map cmd+p launch --type=overlay ~/dotfiles/kitty/tab-picker.sh

# ----------------------------------------------------------------------------
# Keybindings: Quick Launch
# ----------------------------------------------------------------------------
# Open editor in current directory
map cmd+e launch --cwd=current --type=overlay $EDITOR .

# Open lazygit in a vertical split
map cmd+g launch --location=vsplit --cwd=current lazygit

# ----------------------------------------------------------------------------
# Keybindings: Misc
# ----------------------------------------------------------------------------
# Reload config
map cmd+shift+comma load_config_file

# Fullscreen
map cmd+shift+enter toggle_fullscreen


# BEGIN_KITTY_THEME
# Catppuccin-Macchiato
include current-theme.conf
# END_KITTY_THEME
